<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Jugadores - IQSCORE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos para tema oscuro */
        [data-theme="dark"] {
            --bg-color: #121212;
            --header-bg: linear-gradient(145deg, #1a1a2e, #16213e);
            --card-bg: #1e1e1e;
            --text-color: #ffffff;
            --text-secondary: #b0b0b0;
            --input-bg: #2d2d2d;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --header-text: #ffffff;
            --error-bg: #2d0707;
            --error-text: #ff6b6b;
            --position-fw: #ff6b6b;
            --position-mf: #4caf50;
            --position-df: #2196f3;
            --position-gk: #ffeb3b;
            --accent-color: #4c4cff;
        }

        /* Estilos para tema claro */
        [data-theme="light"] {
            --bg-color: #f8f9fa;
            --header-bg: linear-gradient(145deg, #3357E9, #2a46c5);
            --card-bg: #ffffff;
            --text-color: #2d3748;
            --text-secondary: #4a5568;
            --input-bg: #edf2f7;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --header-text: #ffffff;
            --error-bg: #fee2e2;
            --error-text: #b91c1c;
            --position-fw: #e53e3e;
            --position-mf: #38a169;
            --position-df: #3182ce;
            --position-gk: #d69e2e;
            --accent-color: #4c4cff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .header-bg {
            background: var(--header-bg);
           box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
       }
        
       main {
           flex: 1;
           padding: 1.5rem;
       }

       .card {
           transition: all 0.3s ease;
           background: var(--card-bg);
           color: var(--text-color);
           border-radius: 10px;
           overflow: hidden;
           box-shadow: var(--card-shadow);
           display: flex;
           flex-direction: column;
           height: 100%;
           border: 1px solid rgba(255, 255, 255, 0.05);
       }
        
       .card:hover {
           transform: translateY(-5px);
           box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
       }

       .theme-switch {
           transition: all 0.3s ease;
           padding: 0.5rem;
           border-radius: 50%;
           background-color: rgba(255, 255, 255, 0.1);
           border: none;
           cursor: pointer;
           width: 40px;
           height: 40px;
           display: flex;
           align-items: center;
           justify-content: center;
       }
        
       .theme-switch:hover {
           background-color: rgba(255, 255, 255, 0.2);
       }
        
       .theme-switch i {
           color: var(--header-text);
           font-size: 1.2rem;
       }

       footer {
           background: var(--header-bg);
           color: var(--header-text);
           text-align: center;
           padding: 1rem;
           margin-top: auto;
           font-size: 0.875rem;
       }

       .selector {
           background-color: var(--input-bg);
           color: var(--text-color);
           border: 1px solid rgba(0, 0, 0, 0.1);
           padding: 0.5rem 1rem;
           border-radius: 8px;
           transition: all 0.3s ease;
           min-width: 200px;
       }
        
       .selector:focus {
           outline: none;
           border-color: var(--accent-color);
           box-shadow: 0 0 0 2px rgba(76, 76, 255, 0.2);
       }

       .player-photo {
           width: 80px;
           height: 80px;
           object-fit: cover;
           border-radius: 50%;
           border: 3px solid;
           margin-right: 1rem;
           flex-shrink: 0;
       }

       .position-fw { border-color: var(--position-fw);
       }
       .position-mf { border-color: var(--position-mf);
       }
       .position-df { border-color: var(--position-df);
       }
       .position-gk { border-color: var(--position-gk);
       }

       .position-tag {
           display: inline-block;
           padding: 0.25rem 0.75rem;
           border-radius: 20px;
           font-weight: 600;
           font-size: 0.75rem;
           margin-right: 0.5rem;
           margin-bottom: 0.5rem;
           background-color: rgba(0, 0, 0, 0.1);
       }

       .position-fw-bg {
           background-color: var(--position-fw);
           color: white;
       }
       .position-mf-bg {
           background-color: var(--position-mf);
           color: white;
       }
       .position-df-bg {
           background-color: var(--position-df);
           color: white;
       }
       .position-gk-bg {
           background-color: var(--position-gk);
           color: #1a202c;
       }

       .stats-grid {
           display: grid;
           grid-template-columns: repeat(2, 1fr);
           gap: 0.75rem;
           margin-top: 1rem;
       }

       .stat-item {
           background: rgba(255, 255, 255, 0.05);
           padding: 0.75rem;
           border-radius: 8px;
           text-align: center;
           transition: all 0.2s ease;
       }
        
       .stat-item:hover {
           transform: translateY(-2px);
           background: rgba(255, 255, 255, 0.1);
       }

       .stat-value {
           font-weight: 700;
           font-size: 1.2rem;
           color: var(--accent-color);
       }

       .stat-label {
           font-size: 0.7rem;
           color: var(--text-secondary);
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       .error-state {
           background-color: var(--error-bg);
           color: var(--error-text);
           padding: 2rem;
           border-radius: 10px;
           text-align: center;
       }

       .empty-state {
           padding: 2rem;
           text-align: center;
           color: var(--text-secondary);
       }
        
       .empty-state-icon {
           font-size: 3rem;
           margin-bottom: 1rem;
           opacity: 0.5;
       }

       .loading-spinner {
           animation: spin 1s linear infinite;
           color: var(--accent-color);
       }
        
       @keyframes spin {
           0% { transform: rotate(0deg);
           }
           100% { transform: rotate(360deg);
           }
       }

       /* Modal styles */
       .modal {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background-color: rgba(0, 0, 0, 0.7);
           z-index: 1000;
           justify-content: center;
           align-items: center;
           backdrop-filter: blur(5px);
       }
        
       .modal-content {
           background: var(--card-bg);
           padding: 2rem;
           border-radius: 12px;
           width: 90%;
           max-width: 800px;
           max-height: 90vh;
           overflow-y: auto;
           box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
           border: 1px solid rgba(255, 255, 255, 0.1);
       }
        
       .modal-close {
           float: right;
           cursor: pointer;
           font-size: 1.5rem;
           transition: all 0.2s ease;
           color: var(--text-secondary);
       }
        
       .modal-close:hover {
           color: var(--text-color);
           transform: scale(1.1);
       }

       .btn {
           padding: 0.6rem 1.2rem;
           border-radius: 8px;
           cursor: pointer;
           font-weight: 600;
           transition: all 0.2s ease;
           border: none;
           display: inline-flex;
           align-items: center;
           justify-content: center;
           gap: 0.5rem;
       }
        
       .btn i {
           font-size: 0.9rem;
       }
        
       .btn-primary {
           background-color: var(--accent-color);
           color: white;
       }
        
       .btn-primary:hover {
           background-color: #3a3aff;
           transform: translateY(-2px);
           box-shadow: 0 4px 8px rgba(76, 76, 255, 0.2);
       }
        
       .btn-danger {
           background-color: #ff4c4c;
           color: white;
       }
        
       .btn-danger:hover {
           background-color: #ff3333;
           transform: translateY(-2px);
           box-shadow: 0 4px 8px rgba(255, 76, 76, 0.2);
       }
        
       .btn-success {
           background-color: #4CAF50;
           color: white;
       }
        
       .btn-success:hover {
           background-color: #3e8e41;
           transform: translateY(-2px);
           box-shadow: 0 4px 8px rgba(76, 175, 80, 0.2);
       }
        
       .btn-secondary {
           background-color: var(--input-bg);
           color: var(--text-color);
       }
        
       .btn-secondary:hover {
           background-color: rgba(255, 255, 255, 0.1);
           transform: translateY(-2px);
       }

       .action-buttons {
           display: flex;
           gap: 0.75rem;
           margin-top: 1.5rem;
       }
        
       .action-buttons .btn {
           flex: 1;
           text-align: center;
           padding: 0.6rem;
           font-size: 0.85rem;
       }

       /* Player details modal */
       .player-details-header {
           display: flex;
           align-items: center;
           margin-bottom: 1.5rem;
           padding-bottom: 1rem;
           border-bottom: 1px solid rgba(255, 255, 255, 0.1);
       }
        
       .player-details-photo {
           width: 100px;
           height: 100px;
           object-fit: cover;
           border-radius: 50%;
           border: 4px solid;
           margin-right: 1.5rem;
       }
        
       .player-details-info {
           flex: 1;
       }
        
       .player-details-name {
           font-size: 1.8rem;
           font-weight: 700;
           margin-bottom: 0.5rem;
       }
        
       .player-details-team {
           font-size: 1.1rem;
           color: var(--text-secondary);
           margin-bottom: 0.5rem;
       }
        
       .player-details-position {
           display: inline-block;
           padding: 0.3rem 1rem;
           border-radius: 20px;
           font-weight: 600;
           margin-right: 0.5rem;
       }
        
       .player-details-stats {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
           gap: 1rem;
           margin: 1.5rem 0;
       }
        
       .player-details-stat {
           background: rgba(255, 255, 255, 0.05);
           padding: 1rem;
           border-radius: 8px;
           text-align: center;
       }
        
       .player-details-stat-value {
           font-size: 1.5rem;
           font-weight: 700;
           margin-bottom: 0.25rem;
           color: var(--accent-color);
       }
        
       .player-details-stat-label {
           font-size: 0.8rem;
           color: var(--text-secondary);
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }
        
       .player-details-section {
           margin-top: 1.5rem;
       }
        
       .player-details-section h3 {
           font-size: 1.2rem;
           font-weight: 600;
           margin-bottom: 1rem;
           color: var(--accent-color);
       }
        
       .player-details-section p {
           line-height: 1.6;
           margin-bottom: 0.5rem;
       }
        
       .nationality-flag {
           font-size: 1.5rem;
           vertical-align: middle;
           margin-right: 0.5rem;
       }
        
       /* Form styles */
       .form-group {
           margin-bottom: 1.25rem;
       }
        
       .form-group label {
           display: block;
           margin-bottom: 0.5rem;
           font-weight: 600;
           color: var(--text-color);
       }
        
       .form-group input,
       .form-group textarea,
       .form-group select {
           width: 100%;
           padding: 0.75rem;
           border-radius: 8px;
           border: 1px solid rgba(255, 255, 255, 0.1);
           background-color: var(--input-bg);
           color: var(--text-color);
           transition: all 0.3s ease;
       }
        
       .form-group input:focus,
       .form-group textarea:focus,
       .form-group select:focus {
           outline: none;
           border-color: var(--accent-color);
           box-shadow: 0 0 0 2px rgba(76, 76, 255, 0.2);
       }
        
       /* Responsive adjustments */
       @media (max-width: 768px) {
           .player-details-header {
               flex-direction: column;
               text-align: center;
           }
            
           .player-details-photo {
               margin-right: 0;
               margin-bottom: 1rem;
           }
            
           .player-details-stats {
               grid-template-columns: repeat(2, 1fr);
           }
            
           .action-buttons {
               flex-direction: column;
           }
       }
        
       /* Custom scrollbar */
       ::-webkit-scrollbar {
           width: 8px;
           height: 8px;
       }
        
       ::-webkit-scrollbar-track {
           background: rgba(255, 255, 255, 0.05);
           border-radius: 10px;
       }
        
       ::-webkit-scrollbar-thumb {
           background: var(--accent-color);
          border-radius: 10px;
      }
        
      ::-webkit-scrollbar-thumb:hover {
          background: #3a3aff;
      }
  </style>
</head>
<body>
    <header class="flex justify-between items-center p-4 header-bg shadow-lg">
        <div class="flex items-center space-x-4">
            <!-- Botón para regresar al menú -->
            <a href="index.html" class="btn btn-primary">
                <i class="fas fa-arrow-left mr-2"></i>Menú Principal
            </a>
            <div class="text-2xl font-bold" style="color: var(--header-text);">IQSCORE - Posiciones de Liga</div>
        </div>
        <div class="flex items-center space-x-4">
            <button class="theme-switch" id="theme-toggle">
                <i id="theme-icon" class="fas fa-moon"></i>
            </button>
            <button class="md:hidden p-2 rounded theme-switch">
                <i class="fas fa-bars" style="color: var(--header-text);"></i>
            </button>
            <button class="hidden md:block p-2 rounded theme-switch"><i class="fas fa-cog" style="color: var(--header-text);"></i></button>
        </div>
    </header>


  <main class="p-4 md:p-6">
      <div class="flex flex-col md:flex-row justify-start mb-6 gap-4 items-center">
          <div class="flex items-center flex-1 min-w-0">
              <label for="liga-select" class="mr-2 font-medium whitespace-nowrap">Liga:</label>
              <select id="liga-select" class="selector flex-1
min-w-0">
                  <option value="">Cargando ligas...</option>
              </select>
          </div>
          <div class="flex items-center flex-1 min-w-0">
              <label for="equipo-select" class="mr-2 font-medium whitespace-nowrap">Equipo:</label>
             <select id="equipo-select" class="selector flex-1 min-w-0" disabled>
                  <option value="">-- Selecciona una liga primero --</option>
              </select>
          </div>
          <button id="add-player-btn" class="btn btn-success whitespace-nowrap" disabled>
              <i class="fas fa-user-plus mr-2"></i>Agregar Jugador
          </button>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="jugadores-container">
          <div id="loading-indicator" class="col-span-full text-center py-12">
              <div class="flex flex-col items-center justify-center">
                  <i class="fas fa-spinner loading-spinner text-4xl mb-4"></i>
                 <p class="text-xl" style="color: var(--text-secondary);">Selecciona una liga y un equipo...</p>
              </div>
          </div>
      </div>
  </main>

    <div id="player-modal" class="modal">
      <div class="modal-content">
          <span class="modal-close">&times;</span>
          <h2 class="text-xl font-bold mb-4" id="modal-title">Agregar Nuevo Jugador</h2>
          <form id="player-form">
              <input type="hidden" id="jugador-id">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div class="form-group">
                    <label for="nombre">Nombre:</label>
                      <input type="text" id="nombre" required>
                  </div>
                  <div class="form-group">
                     <label for="edad">Edad:</label>
                      <input type="number" id="edad" min="16" max="50">
                  </div>
                  <div class="form-group">
                      <label for="fecha_nacimiento">Fecha Nacimiento:</label>
                      <input type="date" id="fecha_nacimiento">
                  </div>
                  <div class="form-group">
                      <label for="nacionalidad">Nacionalidad:</label>
                     <input type="text" id="nacionalidad">
                  </div>
                  <div class="form-group">
                      <label for="altura">Altura (m):</label>
                     <input type="number" id="altura" step="0.01" min="1.50" max="2.20">
                  </div>
                  <div class="form-group">
                      <label for="peso">Peso (kg):</label>
                     <input type="number" id="peso" min="50" max="100">
                  </div>
                  <div class="form-group">
                      <label for="pierna_habil">Pierna Hábil:</label>
                     <select id="pierna_habil">
                          <option value="">Seleccionar</option>
                          <option value="Derecha">Derecha</option>
                          <option value="Izquierda">Izquierda</option>
                         <option value="Ambidiestro">Ambidiestro</option>
                      </select>
                  </div>
                  <div class="form-group">
                     <label for="posicion">Posición:</label>
                      <input type="text" id="posicion" placeholder="Ej: Delantero, Mediocampista">
                  </div>
                  <div class="form-group">
                     <label for="posicion_ideal">Posición Ideal:</label>
                      <input type="text" id="posicion_ideal" placeholder="Ej: Delantero centro">
                  </div>
                  <div class="form-group">
                      <label
for="idEquipoActual">Equipo Actual:</label>
                      <select id="idEquipoActual" required disabled>
                          <option value="">Selecciona un equipo</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label for="valor_mercado">Valor de Mercado (€):</label>
                      <input type="number" id="valor_mercado" step="0.01" min="0">
                  </div>
                  <div class="form-group">
                      <label for="numero_camiseta">Número Camiseta:</label>
                      <input type="number" id="numero_camiseta" min="1" max="99">
                  </div>
                  <div class="form-group">
                      <label for="logo">URL Foto:</label>
                      <input type="url" id="logo" placeholder="https://ejemplo.com/foto.jpg">
                  </div>
                  <div class="form-group md:col-span-2">
                      <label for="habilidades">Habilidades:</label>
                      <textarea id="habilidades" rows="3" placeholder="Ej: Regate, Disparo potente, Visión de juego"></textarea>
                  </div>

                                    <div class="form-group">
                      <label for="nacionalidad_logo">URL Logo Nacionalidad:</label>
                      <input type="url" id="nacionalidad_logo" placeholder="https://ejemplo.com/bandera.png">
                  </div>
                  <div class="form-group md:col-span-2">
                      <label for="caracteristicas">Características:</label>
                      <textarea id="caracteristicas" rows="3" placeholder="Describe las características del jugador..."></textarea>
                  </div>
                  <div class="form-group md:col-span-2">
                      <label for="atributos">Atributos:</label>
                      <textarea id="atributos" rows="3" placeholder="Describe los atributos del jugador..."></textarea>
                  </div>
                                </div>
              <div class="action-buttons mt-6">
                  <button type="submit" class="btn btn-primary">
                      <i class="fas fa-save mr-2"></i>Guardar
                  </button>
                  <button type="button" class="btn btn-danger modal-close">
                      <i class="fas fa-times mr-2"></i>Cancelar
                  </button>
              </div>
          </form>
      </div>
  </div>

    <div id="confirm-modal" class="modal">
      <div class="modal-content">
          <h2 class="text-xl font-bold mb-4" id="confirm-title">Confirmar Eliminación</h2>
          <p id="confirm-message">¿Estás seguro de que deseas eliminar este jugador?</p>
          <div class="action-buttons mt-4">
              <button id="confirm-yes" class="btn btn-danger">
                <i class="fas fa-trash-alt mr-2"></i>Sí, Eliminar
              </button>
              <button id="confirm-no" class="btn btn-primary">
                  <i class="fas fa-times mr-2"></i>Cancelar
              </button>
          </div>
      </div>
  </div>

    <div id="player-details-modal" class="modal">
      <div class="modal-content">
          <span class="modal-close" onclick="closePlayerDetailsModal()">&times;</span>
          <div id="player-details-content">
              <div class="flex justify-center py-8">
                 <i class="fas fa-spinner loading-spinner text-4xl"></i>
              </div>
          </div>
      </div>
  </div>

  <footer class="mt-auto">
      &copy;
<span id="current-year"></span> IQSCORE. Todos los derechos reservados.
  </footer>

  <script>
      // Configuración de URLs API
      const API_BASE_URL = "http://localhost:3001/api";
      const LIGAS_API_URL = `${API_BASE_URL}/ligas`;
      const EQUIPOS_POR_LIGA_API_URL = (ligaId) => `${API_BASE_URL}/liga/equipos/${ligaId}`;
      const JUGADORES_POR_EQUIPO_API_URL = (equipoId) => `${API_BASE_URL}/equipo/jugadores/${equipoId}`;
      const JUGADOR_API_URL = (jugadorId) => `${API_BASE_URL}/jugadores/${jugadorId}`;
      const JUGADORES_API_URL = `${API_BASE_URL}/jugadores`;
      const JUGADOR_DETALLES_API_URL = (jugadorId) => `${API_BASE_URL}/jugadordetalles/${jugadorId}`;

      // Elementos del DOM
      const elements = {
          jugadoresContainer: document.getElementById("jugadores-container"),
          ligaSelect: document.getElementById("liga-select"),
          equipoSelect: document.getElementById("equipo-select"),
          loadingIndicator: document.getElementById("loading-indicator"),
          addPlayerBtn: document.getElementById("add-player-btn"),
          playerModal: document.getElementById("player-modal"),
          confirmModal: document.getElementById("confirm-modal"),
          playerDetailsModal: document.getElementById("player-details-modal"),
          playerForm: document.getElementById("player-form"),
          modalTitle: document.getElementById("modal-title"),
          jugadorIdInput: document.getElementById("jugador-id"),
          equipoSelectModal: document.getElementById("idEquipoActual"),
          playerDetailsContent: document.getElementById("player-details-content"),
          confirmMessage: document.getElementById("confirm-message")
      };

      // Variables de estado
      let state = {
          allLigas: [],
          allEquipos: [],
          currentLigaId: null,
          currentEquipoId: null,
          jugadorToDelete: null,
          currentJugadores: [],
          currentTheme: localStorage.getItem('theme') ||
'dark'
      };

      // Inicialización
      document.addEventListener("DOMContentLoaded", async () => {
          setupThemeToggle();
          setupModals();
          setupEventListeners();
            
          await loadLigasForSelect();
          updateCurrentYear();
          
          showLoadingIndicator("Selecciona una liga para empezar...");
      });

      // Configuración del tema
      function setupThemeToggle() {
          const themeToggle = document.getElementById('theme-toggle');
          const themeIcon = document.getElementById('theme-icon');
          const htmlElement = document.documentElement;

          // Aplicar tema guardado o por defecto
          htmlElement.setAttribute('data-theme', state.currentTheme);
          updateThemeIcon(state.currentTheme);

          themeToggle.addEventListener('click', () => {
              state.currentTheme = state.currentTheme === 'dark' ? 'light' : 'dark';
              htmlElement.setAttribute('data-theme', state.currentTheme);
              localStorage.setItem('theme', state.currentTheme);
              updateThemeIcon(state.currentTheme);
          });

          function updateThemeIcon(theme) {
              if (theme === 'dark') {
                  themeIcon.classList.remove('fa-sun');
                  themeIcon.classList.add('fa-moon');
              } else {
                  themeIcon.classList.remove('fa-moon');
                  themeIcon.classList.add('fa-sun');
              }
          }
      }

      // Configuración de modales
      function setupModals() {
          // Cerrar modales con botones de cerrar
          document.querySelectorAll('.modal-close, #confirm-no').forEach(btn => {
              btn.addEventListener('click', () => {
                 elements.playerModal.style.display = 'none';
                  elements.confirmModal.style.display = 'none';
              });
          });

          // Cerrar modales haciendo clic fuera
          window.addEventListener('click', (event) => {
              if (event.target === elements.playerModal) elements.playerModal.style.display = 'none';
              if (event.target === elements.confirmModal) elements.confirmModal.style.display = 'none';
              if (event.target === elements.playerDetailsModal) elements.playerDetailsModal.style.display = 'none';
          });

          // Confirmar eliminación
          document.getElementById('confirm-yes').addEventListener('click', () => {
              if (state.jugadorToDelete) {
                  deleteJugador(state.jugadorToDelete);
              }
              elements.confirmModal.style.display = 'none';
          });
      }

      // Configuración de event listeners
      function setupEventListeners() {
          // Cambio de liga
          elements.ligaSelect.addEventListener('change', async () => {
              state.currentLigaId = elements.ligaSelect.value;
              state.currentEquipoId = null;
              elements.equipoSelect.value = '';
              elements.jugadoresContainer.innerHTML = '';
              elements.addPlayerBtn.disabled = true;
                
              await loadEquiposForSelect(state.currentLigaId);
          });

          // Cambio de equipo
          elements.equipoSelect.addEventListener('change', () => {
              state.currentEquipoId = elements.equipoSelect.value;
              loadJugadores(state.currentEquipoId);
          });

          // Botón agregar jugador
          elements.addPlayerBtn.addEventListener('click', () => {
              openPlayerModal();
          });

          // Envío del formulario
          elements.playerForm.addEventListener('submit', async (e) => {
              e.preventDefault();
              await saveJugador();
          });
      }

      // Cargar ligas para el selector
      async function loadLigasForSelect() {
          try {
              showLoadingIndicator("Cargando ligas...");
              const response = await fetch(LIGAS_API_URL);
              if (!response.ok) throw new Error(`Error ${response.status}: ${response.statusText}`);
                
              state.allLigas = await response.json();
              elements.ligaSelect.innerHTML = '<option value="">-- Selecciona Liga --</option>';
                
              if (state.allLigas.length > 0) {
                  state.allLigas.forEach(liga => {
                      const option = document.createElement('option');
                      option.value = liga.idLiga;
                      option.textContent = liga.nombre;
                      elements.ligaSelect.appendChild(option);
                  });
              } else {
                  elements.ligaSelect.innerHTML = '<option value="">No hay ligas disponibles</option>';
                  showEmptyState(null, null, true);
              }
          } catch (error) {
              console.error("Error cargando ligas:", error);
              elements.ligaSelect.innerHTML = '<option value="">Error al cargar ligas</option>';
              showErrorState("No se pudieron cargar las ligas.", error.message);
          } finally {
              hideLoadingIndicator();
          }
      }

      // Cargar equipos para el selector
      async function loadEquiposForSelect(ligaId) {
          if (!ligaId) {
              elements.equipoSelect.innerHTML = '<option value="">-- Selecciona una liga primero --</option>';
              elements.equipoSelect.disabled = true;
              elements.addPlayerBtn.disabled = true;
              return;
          }

          try {
              showLoadingIndicator("Cargando equipos...");
              elements.equipoSelect.disabled = true;
              elements.equipoSelect.innerHTML = '<option value="">Cargando equipos...</option>';
              elements.addPlayerBtn.disabled = true;

              const url = EQUIPOS_POR_LIGA_API_URL(ligaId);
              const response = await fetch(url);
              if (!response.ok) throw new Error(`Error ${response.status}: ${response.statusText}`);

              const equiposData = await response.json();
              state.allEquipos = equiposData.map(eq => ({
                  idEquipo: eq.idEquipo || eq.ID_Equipo,
                  nombre: eq.nombre || eq.Nombre
              }));
              elements.equipoSelect.innerHTML = '<option value="">-- Selecciona Equipo --</option>';
                
              if (state.allEquipos.length > 0) {
                  state.allEquipos.forEach(equipo => {
                      const option = document.createElement('option');
                      option.value = equipo.idEquipo;
                      option.textContent = equipo.nombre;
                      elements.equipoSelect.appendChild(option);
                  });
                  elements.equipoSelect.disabled = false;
                  showLoadingIndicator("Selecciona un equipo para ver sus jugadores...");
              } else {
                  elements.equipoSelect.innerHTML = '<option value="">No hay equipos en esta liga</option>';
                  showEmptyState(ligaId, null);
              }
          } catch (error) {
              console.error("Error cargando equipos:", error);
              elements.equipoSelect.innerHTML = '<option value="">Error al cargar equipos</option>';
              showErrorState("No se pudieron cargar los equipos.", error.message);
          } finally {
              hideLoadingIndicator();
          }
      }

      // Cargar jugadores de un equipo
      async function loadJugadores(equipoId) {
          if (!equipoId) {
              showLoadingIndicator("Selecciona un equipo para ver sus jugadores...");
              elements.jugadoresContainer.innerHTML = '';
              elements.addPlayerBtn.disabled = true;
              return;
          }

          try {
              showLoadingIndicator("Cargando jugadores...");
              elements.addPlayerBtn.disabled = false;

              const url = JUGADORES_POR_EQUIPO_API_URL(equipoId);
              const response = await fetch(url);
              if (!response.ok) {
                  let errorDetail = `Error ${response.status}: ${response.statusText}`;
                  try {
                      const errorData = await response.json();
                      errorDetail = errorData.message || errorData.error || errorDetail;
                  } catch (e) {}
                  throw new Error(errorDetail);
              }

              const jugadoresData = await response.json();
              state.currentJugadores = jugadoresData.map(j => ({
                  idJugador: j.ID_Jugador || j.idJugador,
                  nombre: j.Nombre || j.nombre,
                  posicion: j.Posicion || j.posicion,
                  edad: j.Edad || j.edad,
                  nacionalidad: j.Nacionalidad || j.nacionalidad,
                  valorMercado: j.Valor_Mercado || j.valor_mercado,
                  logo: j.Foto || j.logo
              }));

              if (state.currentJugadores.length === 0) {
                  showEmptyState(state.currentLigaId, equipoId);
              } else {
                  renderJugadores(state.currentJugadores);
              }
          } catch (error) {
              console.error("Error cargando jugadores:", error);
              handleLoadError(error, () => loadJugadores(equipoId));
          } finally {
              hideLoadingIndicator();
          }
      }

      // Renderizar lista de jugadores
      function renderJugadores(jugadores) {
          elements.jugadoresContainer.innerHTML = '';
          jugadores.forEach(jugador => {
              const jugadorElement = document.createElement("div");
              jugadorElement.className = "card shadow-lg flex flex-col";
                
              // Determinar clase de posición para el estilo
              const posicion =
jugador.posicion || '';
              let positionClass = '';
              let positionBgClass = '';
                
              if (posicion.toLowerCase().includes('delantero') || posicion.toLowerCase().includes('forward')) {
                  positionClass = 'position-fw';
                  positionBgClass = 'position-fw-bg';
              } else if (posicion.toLowerCase().includes('medio') || posicion.toLowerCase().includes('midfielder')) {
                  positionClass = 'position-mf';
                  positionBgClass = 'position-mf-bg';
             } else if (posicion.toLowerCase().includes('defensa') || posicion.toLowerCase().includes('defender')) {
                  positionClass = 'position-df';
                  positionBgClass = 'position-df-bg';
              } else if (posicion.toLowerCase().includes('portero') || posicion.toLowerCase().includes('goalkeeper')) {
                  positionClass = 'position-gk';
                  positionBgClass = 'position-gk-bg';
              }

              const valorMercadoFormateado = jugador.valorMercado
                  ?
                  '€' + new Intl.NumberFormat('de-DE').format(parseFloat(jugador.valorMercado))
                  : 'N/A';

              jugadorElement.innerHTML = `
                  <div class="p-4 flex items-center">
                      <img src="${jugador.logo || 'https://via.placeholder.com/80?text=Jugador'}"
                           alt="${jugador.nombre}"
                         class="player-photo ${positionClass}"
                           onerror="this.onerror=null; this.src='https://via.placeholder.com/80?text=Error'">
                      <div class="flex-grow">
                          <h3 class="text-lg font-bold mb-1 truncate">${jugador.nombre}</h3>
                         <div class="flex flex-wrap">
                              <span class="position-tag ${positionBgClass}">${posicion ||
'Sin posición'}</span>
                          </div>
                          <p class="text-sm mt-1" style="color: var(--text-secondary);">
                              <i class="fas fa-euro-sign mr-1"></i>${valorMercadoFormateado}
                          </p>
                      </div>
                  </div>
                  <div class="mt-auto p-4 pt-0">
                      <div class="action-buttons">
                          <button class="btn btn-primary details-btn" data-id="${jugador.idJugador}">
                              <i class="fas fa-eye mr-1"></i> Detalles
                          </button>
                          <button class="btn btn-secondary edit-btn" data-id="${jugador.idJugador}">
                              <i class="fas fa-edit mr-1"></i> Editar
                          </button>
                          <button class="btn btn-danger delete-btn" data-id="${jugador.idJugador}">
                              <i class="fas fa-trash-alt mr-1"></i> Eliminar
                          </button>
                      </div>
                  </div>
              `;
              elements.jugadoresContainer.appendChild(jugadorElement);
          });

          // Agregar event listeners a los botones
          document.querySelectorAll('.details-btn').forEach(btn => {
              btn.addEventListener('click', (e) => {
                  const jugadorId = e.currentTarget.getAttribute('data-id');
                  showPlayerDetails(jugadorId);
              });
          });

          document.querySelectorAll('.edit-btn').forEach(btn => {
              btn.addEventListener('click', async (e) => {
                  const jugadorId = e.currentTarget.getAttribute('data-id');
                  try {
                      const response = await fetch(JUGADOR_API_URL(jugadorId));
                     if (!response.ok) throw new Error('No se pudo cargar datos para editar');
                      const jugadorDetalles = await response.json();
                      openPlayerModal(jugadorDetalles);
                  } catch(error) {
                      console.error("Error cargando jugador para editar:", error);
                      showErrorState("Error al cargar datos del jugador para editar.", error.message);
                  }
              });
          });

          document.querySelectorAll('.delete-btn').forEach(btn => {
              btn.addEventListener('click', (e) => {
                  const jugadorId = e.currentTarget.getAttribute('data-id');
                  const jugador = state.currentJugadores.find(j => j.idJugador == jugadorId);
                  if (jugador) {
                     showConfirmModal(jugador);
                  }
              });
          });
      }

      // Mostrar modal de confirmación
      function showConfirmModal(jugador) {
          state.jugadorToDelete = jugador.idJugador;
          elements.confirmMessage.textContent = `¿Estás seguro de que deseas eliminar a ${jugador.nombre}?`;
          elements.confirmModal.style.display = 'flex';
      }

      // Eliminar jugador
      async function deleteJugador(jugadorId) {
          try {
              const url = JUGADOR_API_URL(jugadorId);
              const response = await fetch(url, { method: 'DELETE' });
              if (!response.ok) throw new Error(`Error ${response.status}: ${response.statusText}`);

              // Recargar lista de jugadores
              loadJugadores(state.currentEquipoId);

              // Mostrar notificación de éxito
              showNotification('Jugador eliminado correctamente', 'success');
          } catch (error) {
              console.error("Error eliminando jugador:", error);
              showErrorState("Error al eliminar el jugador.", error.message);
          }
      }

      // Abrir modal para agregar/editar jugador
      function openPlayerModal(jugador = null) {
          // Llenar selector de equipo en el modal
          if (elements.equipoSelectModal.options.length <= 1 && state.allEquipos.length > 0) {
              elements.equipoSelectModal.innerHTML = '<option value="">-- Selecciona Equipo</option>';
              state.allEquipos.forEach(eq => {
                  const option = document.createElement('option');
                  option.value = eq.idEquipo;
                  option.textContent = eq.nombre;
                  elements.equipoSelectModal.appendChild(option);
             });
          }

          elements.playerForm.reset();
          elements.jugadorIdInput.value = '';

          if (jugador) {
              elements.modalTitle.textContent = 'Editar Jugador';
              elements.jugadorIdInput.value = jugador.idJugador || jugador.ID_Jugador;

              // Llenar campos del formulario
              document.getElementById('nombre').value = jugador.nombre ||
jugador.Nombre || '';
              document.getElementById('edad').value = jugador.edad || jugador.Edad || '';
              document.getElementById('fecha_nacimiento').value = jugador.fecha_nacimiento ? jugador.fecha_nacimiento.split('T')[0] : '';
              document.getElementById('nacionalidad').value = jugador.nacionalidad || jugador.Nacionalidad || '';
              document.getElementById('altura').value = jugador.altura || '';
              document.getElementById('peso').value = jugador.peso || '';
              document.getElementById('pierna_habil').value = jugador.pierna_habil || '';
              document.getElementById('posicion').value = jugador.posicion || jugador.Posicion || '';
              document.getElementById('posicion_ideal').value = jugador.posicion_ideal || '';
              document.getElementById('idEquipoActual').value = jugador.idEquipoActual || state.currentEquipoId || '';
              document.getElementById('valor_mercado').value = jugador.valor_mercado || jugador.Valor_Mercado || '';
              document.getElementById('numero_camiseta').value = jugador.numero_camiseta ?? '';
              document.getElementById('logo').value = jugador.logo || jugador.Foto || '';
              document.getElementById('habilidades').value = jugador.habilidades || '';

              // === LÍNEAS AÑADIDAS PARA POBLAR NUEVOS CAMPOS ===
              document.getElementById('nacionalidad_logo').value = jugador.nacionalidad_logo || '';
              document.getElementById('caracteristicas').value = jugador.caracteristicas || '';
              document.getElementById('atributos').value = jugador.atributos || '';
              // === FIN LÍNEAS AÑADIDAS ===

              elements.equipoSelectModal.disabled = false;
          } else {
              elements.modalTitle.textContent = 'Agregar Nuevo Jugador';
              if (state.currentEquipoId) {
                  document.getElementById('idEquipoActual').value = state.currentEquipoId;
                  elements.equipoSelectModal.disabled = true;
              } else {
                  elements.equipoSelectModal.disabled = false;
              }
          }
            
          elements.playerModal.style.display = 'flex';
      }

      // Guardar jugador (crear o actualizar)
      async function saveJugador() {
          const jugadorData = {
              nombre: document.getElementById('nombre').value,
              edad: document.getElementById('edad').value ||
null,
              fecha_nacimiento: document.getElementById('fecha_nacimiento').value ||
null,
              nacionalidad: document.getElementById('nacionalidad').value,
              altura: document.getElementById('altura').value ||
null,
              peso: document.getElementById('peso').value ||
null,
              pierna_habil: document.getElementById('pierna_habil').value,
              posicion: document.getElementById('posicion').value,
              posicion_ideal: document.getElementById('posicion_ideal').value,
              idEquipoActual: document.getElementById('idEquipoActual').value,
              valor_mercado: document.getElementById('valor_mercado').value ||
null,
              numero_camiseta: document.getElementById('numero_camiseta').value ||
null,
              logo: document.getElementById('logo').value,
              habilidades: document.getElementById('habilidades').value,

              // === CAMPOS AÑADIDOS AL OBJETO A ENVIAR ===
              nacionalidad_logo: document.getElementById('nacionalidad_logo').value || null,
              caracteristicas: document.getElementById('caracteristicas').value || null,
              atributos: document.getElementById('atributos').value || null
              // === FIN CAMPOS AÑADIDOS ===
          };

          const jugadorId = elements.jugadorIdInput.value;
          const method = jugadorId ? 'PUT' : 'POST';
          const url = jugadorId ? JUGADOR_API_URL(jugadorId) : JUGADORES_API_URL;

          try {
              const response = await fetch(url, {
                  method: method,
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(jugadorData)
              });
                
              if (!response.ok) {
                  const errorData = await response.json().catch(() => ({ message: `Error ${response.status}` }));
                  throw new Error(errorData.message || `Error ${response.status}: ${response.statusText}`);
              }

              elements.playerModal.style.display = 'none';
              loadJugadores(state.currentEquipoId);
                
              // Mostrar notificación de éxito
              showNotification(`Jugador ${jugadorId ? 'actualizado' : 'agregado'} correctamente`, 'success');
          } catch (error) {
              console.error("Error guardando jugador:", error);
              // Idealmente, mostrar el error en el modal en lugar de toda la pantalla
              alert(`Error al guardar el jugador: ${error.message}`);
              // Opcionalmente, podrías añadir un div de error dentro del modal
              // showErrorState("Error al guardar el jugador.", error.message); // Esto reemplaza toda la vista de jugadores
          }
      }

      // Mostrar detalles del jugador
      async function showPlayerDetails(jugadorId) {
          try {
              elements.playerDetailsContent.innerHTML = `
                  <div class="flex justify-center py-8">
                     <i class="fas fa-spinner loading-spinner text-4xl"></i>
                  </div>
              `;
              elements.playerDetailsModal.style.display = 'flex';

              const url = JUGADOR_DETALLES_API_URL(jugadorId);
              const response = await fetch(url);
              if (!response.ok) {
                  let errorDetail = `Error ${response.status}: ${response.statusText}`;
                  try {
                      const errorData = await response.json();
                      errorDetail = errorData.message || errorData.error || errorDetail;
                  } catch (e) {}
                  throw new Error(errorDetail);
              }

              const detalles = await response.json();
              renderPlayerDetails(detalles);
          } catch (error) {
              console.error("Error cargando detalles del jugador:", error);
              elements.playerDetailsContent.innerHTML = `
                  <div class="error-state p-4">
                      <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                      <p class="font-bold">Error al cargar los detalles</p>
                     <p class="text-sm mt-2">${error.message}</p>
                  </div>
              `;
          }
      }

      // Renderizar detalles del jugador
      function renderPlayerDetails(detalles) {
          // Determinar clase de posición para el estilo
          const posicion = detalles.posicion ||
'';
          let positionClass = '';
          let positionBgClass = '';
            
          if (posicion.toLowerCase().includes('delantero') || posicion.toLowerCase().includes('forward')) {
              positionClass = 'position-fw';
              positionBgClass = 'position-fw-bg';
          } else if (posicion.toLowerCase().includes('medio') || posicion.toLowerCase().includes('midfielder')) {
              positionClass = 'position-mf';
              positionBgClass = 'position-mf-bg';
          } else if (posicion.toLowerCase().includes('defensa') || posicion.toLowerCase().includes('defender')) {
              positionClass = 'position-df';
              positionBgClass = 'position-df-bg';
          } else if (posicion.toLowerCase().includes('portero') || posicion.toLowerCase().includes('goalkeeper')) {
              positionClass = 'position-gk';
              positionBgClass = 'position-gk-bg';
          }

          const valorMercadoFormateado = detalles.valor_mercado
              ?
              '€' + new Intl.NumberFormat('de-DE').format(parseFloat(detalles.valor_mercado))
              : 'N/A';

          const fechaNacimiento = detalles.fecha_nacimiento
              ?
              new Date(detalles.fecha_nacimiento).toLocaleDateString('es-ES', {
                  year: 'numeric', month: 'long', day: 'numeric'
                })
              : 'N/A';
          const edad = detalles.edad ? `${detalles.edad} años` : 'N/A';
          const nacionalidadLogoHtml = detalles.nacionalidad_logo ? `<img src="${detalles.nacionalidad_logo}" alt="Bandera" class="inline-block h-4 w-auto ml-1">` : ''; // Modificado para usar img si es URL

          elements.playerDetailsContent.innerHTML = `
              <div class="player-details-header">
                  <img src="${detalles.logo || 'https://via.placeholder.com/100?text=Jugador'}"
                       alt="${detalles.nombre}"
                    class="player-details-photo ${positionClass}"
                       onerror="this.onerror=null; this.src='https://via.placeholder.com/100?text=Error'">
                  <div class="player-details-info">
                      <h2 class="player-details-name">${detalles.nombre ||
'Jugador'}</h2>
                      <p class="player-details-team">
                          ${detalles.equipo_actual ||
'Sin equipo'}
                          ${detalles.liga ?
`(${detalles.liga})` : ''}
                      </p>
                      <div>
                          <span class="player-details-position ${positionBgClass}">
                           ${posicion ||
'Sin posición'}
                          </span>
                          <span class="text-sm" style="color: var(--text-secondary);">
                              ${edad} |
${detalles.nacionalidad || 'N/A'} ${nacionalidadLogoHtml}
                          </span>
                      </div>
                  </div>
              </div>

               <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                      <h3 class="player-details-section">Información Básica</h3>
                      <p><strong>Fecha de Nacimiento:</strong> ${fechaNacimiento}</p>
                     <p><strong>Edad:</strong> ${edad}</p>
                      <p><strong>Nacionalidad:</strong> ${detalles.nacionalidad ||
'N/A'} ${nacionalidadLogoHtml}</p>
                      <p><strong>Altura:</strong> ${detalles.altura ?
detalles.altura + ' m' : 'N/A'}</p>
                      <p><strong>Peso:</strong> ${detalles.peso ?
detalles.peso + ' kg' : 'N/A'}</p>
                      <p><strong>Pierna Hábil:</strong> ${detalles.pierna_habil ||
'N/A'}</p>
                      <p><strong>Posición Ideal:</strong> ${detalles.posicion_ideal ||
'N/A'}</p>
                      <p><strong>Número de Camiseta:</strong> ${detalles.numero_camiseta ||
'N/A'}</p>
                      <p><strong>Valor de Mercado:</strong> ${valorMercadoFormateado}</p>
                  </div>

                  <div>
                      <h3 class="player-details-section">Estadísticas</h3>
                      <div class="player-details-stats">
                          <div class="player-details-stat">
                              <div class="player-details-stat-value">${detalles.partidos_jugados ??
'0'}</div>
                              <div class="player-details-stat-label">Partidos</div>
                          </div>
                          <div class="player-details-stat">
                             <div class="player-details-stat-value">${detalles.goles ??
'0'}</div>
                              <div class="player-details-stat-label">Goles</div>
                          </div>
                          <div class="player-details-stat">
                             <div class="player-details-stat-value">${detalles.asistencias ??
'0'}</div>
                              <div class="player-details-stat-label">Asistencias</div>
                          </div>
                          <div class="player-details-stat">
                             <div class="player-details-stat-value">${detalles.tarjetas_amarillas ??
'0'}</div>
                              <div class="player-details-stat-label">Amarillas</div>
                          </div>
                          <div class="player-details-stat">
                             <div class="player-details-stat-value">${detalles.tarjetas_rojas ??
'0'}</div>
                              <div class="player-details-stat-label">Rojas</div>
                          </div>
                          <div class="player-details-stat">
                             <div class="player-details-stat-value">${detalles.pases_completados ??
'0'}</div>
                              <div class="player-details-stat-label">Pases</div>
                          </div>
                      </div>
                   </div>
              </div>

              <div class="player-details-section">
                  <h3>Habilidades</h3>
                  <p>${detalles.habilidades ||
'No hay información disponible.'}</p>
              </div>

              <div class="player-details-section">
                  <h3>Características</h3>
                  <p>${detalles.caracteristicas ||
'No hay información disponible.'}</p>
              </div>

              <div class="player-details-section">
                  <h3>Atributos</h3>
                  <p>${detalles.atributos ||
'No hay información disponible.'}</p>
              </div>

              <div class="action-buttons">
                  <button class="btn btn-primary" onclick="closePlayerDetailsModal()">
                      <i class="fas fa-times mr-2"></i> Cerrar
                  </button>
              </div>
          `;
      }

      // Cerrar modal de detalles
      function closePlayerDetailsModal() {
          elements.playerDetailsModal.style.display = 'none';
      }

      // Mostrar indicador de carga
      function showLoadingIndicator(message = "Cargando...") {
          elements.loadingIndicator.innerHTML = `
              <div class="flex flex-col items-center justify-center py-8">
                  <i class="fas fa-spinner loading-spinner text-4xl mb-4"></i>
               <p class="text-xl" style="color: var(--text-secondary);">${message}</p>
              </div>`;
          elements.loadingIndicator.style.display = 'block';
      }

      // Ocultar indicador de carga
      function hideLoadingIndicator() {
          elements.loadingIndicator.style.display = 'none';
      }

      // Mostrar estado vacío
      function showEmptyState(ligaId, equipoId, noLigas = false) {
          hideLoadingIndicator();
          let message = '';
          if (noLigas) {
              message = 'No hay ligas disponibles para mostrar.';
          } else if (!ligaId) {
              message = 'Selecciona una liga para empezar.';
          } else if (!equipoId) {
              message = 'Selecciona un equipo para ver sus jugadores.';
          } else {
              message = 'No se encontraron jugadores en el equipo seleccionado.';
          }

          elements.jugadoresContainer.innerHTML = `
              <div class="col-span-full empty-state py-12">
                  <i class="fas fa-users-slash empty-state-icon"></i>
                  <p class="text-xl font-medium mb-4">${message}</p>
                  ${(ligaId
&& equipoId && !noLigas) ?
                      `<button onclick="openPlayerModal()" class="btn btn-success">
                          <i class="fas fa-user-plus mr-2"></i>Agregar Jugador
                      </button>` : ''
                  }
             </div>
          `;
      }

      // Mostrar estado de error
      function showErrorState(errorMessage, errorDetails, retryCallback) {
          hideLoadingIndicator();
          console.error(errorMessage, errorDetails);

          elements.jugadoresContainer.innerHTML = `
              <div class="col-span-full error-state py-12">
                  <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                  <p class="text-xl font-medium mb-2">${errorMessage}</p>
                  <p class="text-sm mb-4">${errorDetails ||
'Error desconocido.'}</p>
                  ${retryCallback ?
                  `<button class="btn btn-primary" onclick="(${retryCallback.toString()})()">
                          <i class="fas fa-sync-alt mr-2"></i>Reintentar
                      </button>` : ''
                  }
              </div>
          `;
      }

      // Manejar errores de carga
      function handleLoadError(error, retryCallback) {
          let errorMessage = "Error al cargar los datos.";
          let errorDetails = error.message || "Error desconocido.";
            
          if (error.name === 'AbortError') {
              errorMessage = "La solicitud tardó demasiado.";
              errorDetails = "Verifica tu conexión o si el servidor está respondiendo.";
          } else if (error.message.includes("Failed to fetch") || error.message.includes("NetworkError")) {
              errorMessage = "No se pudo conectar al servidor.";
              errorDetails = `Verifica tu conexión y que la URL base (${API_BASE_URL}) sea correcta.`;
          } else if (error.message.includes("404")) {
              errorMessage = "Recurso no encontrado (404).";
              errorDetails = `La URL solicitada podría ser incorrecta.`;
          } else if (error.message.includes("500")) {
              errorMessage = "Error interno del servidor (500).";
              errorDetails = "El servidor encontró un problema.";
          }
            
          showErrorState(errorMessage, errorDetails, retryCallback);
      }

      // Mostrar notificación
      function showNotification(message, type = 'info') {
          const notification = document.createElement('div');
          notification.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg text-white ${
              type === 'success' ?
'bg-green-500' :
              type === 'error' ?
'bg-red-500' : 'bg-blue-500'
          }`;
          notification.innerHTML = `
              <div class="flex items-center">
                  <i class="fas ${
                      type === 'success' ? 'fa-check-circle' :
                      type === 'error' ?
'fa-exclamation-circle' : 'fa-info-circle'
                  } mr-2"></i>
                  <span>${message}</span>
              </div>
          `;
          document.body.appendChild(notification);
            
          setTimeout(() => {
              notification.style.transition = 'opacity 0.5s ease';
              notification.style.opacity = '0';
              setTimeout(() => notification.remove(), 500);
          }, 3000);
      }

      // Actualizar año en el footer
      function updateCurrentYear() {
          document.getElementById('current-year').textContent = new Date().getFullYear();
      }
  </script>
</body>
</html>